window.dialogr=function(h){function L(a,c){var b=a.idPrefix+"btn-",d;d=c.key;null===d.match(/^[a-zA-Z]/)&&(d="a"+d);d=d.replace(/[^a-zA-Z0-9-_]/,"").toLowerCase();var b={type:"button",id:b+d},e;c.config&&(e=c.config.text?c.config.text:"");e||(e=c.key);d=document.createElement("button");"undefined"!==typeof b&&p(d,b);d.innerText=e;return d}function k(a){var c=[],b;if(null===a)return[];if(Object.keys)c=Object.keys(a);else for(b in a)M.call(a,b)&&c.push(b);return c}function q(a){return"function"===typeof a}
function t(a,c){var b={},d,e,f;if("undefined"===typeof c)return a;e=k(a);for(f=0;f<e.length;f+=1)d=e[f],b[d]=a[d];e=k(c);for(f=0;f<e.length;f+=1)d=e[f],null==c[d]?delete b[d]:b[d]=c[d].constructor==Array?c[d]:"object"===typeof b[d]&&"object"===typeof c[d]?t(b[d],c[d]):c[d];if(2<arguments.length)for(f=2;f<arguments.length;f+=1)b=t(b,arguments[f]);return b}function N(a){return q(a)?a():a}function p(a,c){var b=k(c),d;if("undefined"!=typeof a)for(d=0;d<b.length;d+=1)"undefined"===typeof c[b[d]]||null===
c[b[d]]?a.hasAttribute(b[d])&&a.removeAttribute(b[d]):a.setAttribute(b[d],c[b[d]])}function n(a,c){var b=k(c),d;if("undefined"!=typeof a)for(d=0;d<b.length;d+=1)a.style[b[d]]=c[b[d]]}function u(a,c,b){var d=document.createElement("div"),e,f;f=k(c);for(e=0;e<f.length;e+=1)a=a.replace("{{"+f[e]+"}}",N(c[f[e]]));if(b)return a;d.innerHTML=a;return 1==d.childNodes.length?d.firstChild:d.childNodes}function A(a,c){!0===c.button.close&&B()}function B(){if(e&&e.wrapper){F(document,"keydown",G);F(h,"resize",
C);e.wrapper.parentElement.removeChild(e.wrapper);e.overlay.parentElement.removeChild(e.overlay);e=null;var a=document.getElementsByTagName("body");1==a.length&&n(a[0],H.body)}}function G(a){27==a.keyCode&&B()}function O(a,c){if(a.attributes["class"]){var b=a.attributes["class"].value;if(b==c)return!0;for(var b=b.split(" "),d=0;d<b.length;d+=1)if(b.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")==c)return!0}return!1}function D(a,c,b){null!=a&&"undefined"!=typeof a&&(a.addEventListener?a.addEventListener(c,
b,!1):a.attachEvent?a.attachEvent("on"+c,b):a["on"+c]=b)}function F(a,c,b){null!=a&&"undefined"!=typeof a&&(a.removeEventListener?a.removeEventListener(c,b,!1):a.detachEvent?a.detachEvent("on"+c,b):a["on"+c]=null)}function C(){var a=e.options,c=document.documentElement,b=Math.max(c.clientWidth,h.innerWidth||0),d=Math.max(c.clientHeight,h.innerHeight||0),c=a.width,g=a.height;null==a.width&&null==a.height||parseInt(a.width,10)>b||parseInt(a.height,10)>d?(c=b+"px",g=d+"px",p(e.wrapper,{"class":"dialogr-fullscreen"})):
(p(e.wrapper,{"class":null}),"border-box"==r(e.wrapper,"box-sizing")?a=w(e.wrapper,!0):(a=l("border-width",e.wrapper),a=x(a,l("padding",e.wrapper))),c=parseInt(c,10)-a.left-a.right+"px",g=parseInt(g,10)-a.top-a.bottom+"px");n(e.wrapper,{width:c,height:g,left:b/2-parseInt(c)/2+"px",top:d/2-parseInt(g)/2+"px"});w(e.wrapper);var d=w(e.content,!0),b=l("margin",e.content),a=l("margin",e.footer),f=l("margin",e.header);e.footer&&(d.bottom+=e.footer.offsetHeight);var m=0,k=0;e.header&&(m=e.header.offsetHeight);
e.header&&(k=e.header.offsetTop);g=parseInt(g,10)-parseInt(m,10)-d.top-d.bottom;f=m+k+f.bottom;d=parseInt(c)-d.left-d.right;g-=b.bottom+b.top+a.top+a.bottom;d-=b.left+b.right;m={top:0,bottom:0,right:0,left:0};"border-box"==r(e.wrapper,"box-sizing")&&(m=l("border-width",e.wrapper),m=x(m,l("padding",e.wrapper)),console.warn(l("padding",e.wrapper)),console.warn(l("margin",e.wrapper)),console.warn(l("border-width",e.wrapper)),d-=m.left+m.right,g-=m.top+m.bottom);n(e.content,{position:"absolute",width:d+
"px",height:g+"px",top:f+"px"});e.footer&&(d=w(e.footer),n(e.footer,{width:parseInt(c)-d.left-d.right-a.left-a.right-m.left-m.right+"px",top:f+e.content.offsetHeight+b.bottom+b.top+"px"}))}function w(a,c){if(!a)return{top:0,bottom:0,right:0,left:0};var b=l("padding",a);!0!==c&&(b=x(b,l("margin",a)));if("content-box"==r(a,"box-sizing"))b=x(b,l("border-width",a));else if("border-box"==r(a,"box-sizing"))return{top:0,bottom:0,right:0,left:0};return b}function x(a,c){var b=k(a),d;for(d=0;d<b.length;d++)a[b[d]]+=
c[b[d]];return a}function l(a,c){var b={top:0,right:0,bottom:0,left:0};if(!c)return b;b=r(c,a).split(" ");1==b.length?(b=parseInt(b[0],10),b={top:b,right:b,bottom:b,left:b}):b={top:parseInt(b[0],10),right:parseInt(b[1],10),bottom:parseInt(b[2],10),left:parseInt(b[3],10)};b.top=isNaN(b.top)?0:b.top;b.right=isNaN(b.right)?0:b.right;b.bottom=isNaN(b.bottom)?b.top:b.bottom;b.left=isNaN(b.left)?b.right:b.left;return b}function r(a,c){if(a.currentStyle)var b=a.currentStyle[c];else h.getComputedStyle&&(b=
document.defaultView.getComputedStyle(a,null).getPropertyValue(c));return b}function I(a,c){var b=null;c||(c=document);"#"==a[0]?b=document.getElementById(a.substr(1)):(b="."==a[0]?document.getElementsByClassName(a.substr(1)):c.querySelector(a),b=0<b.length?b[0]:null);return b}function y(){return h.parent&&h.parent!=h&&h.parent.dialogr?h.parent.dialogr.isOpen():!1}var M=Object.prototype.hasOwnProperty,J={OK_BTN:"OK",CANCEL_BTN:"Cancel",CLOSE_BTN:"Close"},v,K,E={},z,H={},e=null;E[J.OK_BTN]=!0;E[J.CANCEL_BTN]=
!1;K={click:A,idPrefix:"dialogr-",args:null,container:null,buttons:null,width:null,height:null,offsetWidth:0,offsetHeight:0,url:null,html:null,title:null,makeButton:null,headerTemplate:'<div id="{{id}}"><h1>{{title}}</h1></div>',footerTemplate:'<div id="{{id}}" class="buttons"></div>',buttonTemplate:'<button id="{{id}}" type="button">{{text}}</button>',iframeTemplate:'<iframe id="{{id}}" frameborder="0" src="{{url}}"></iframe>',contentTemplate:'<div id="{{id}}">{{html}}</div>',wrapperTemplate:'<div id="{{id}}"></div>'};
return{open:function(a){var c,b=!1;c=document.getElementsByTagName("body");1==c.length&&(H.body={"overflow-y":r(c[0],"overflow-y")},n(c[0],{"overflow-y":"hidden"}));a&&a.footerTemplate&&(b=!0);a&&"undefined"===typeof a.buttons&&(a.buttons=E);a=t(K,a);if(a.buttons)for(d=k(a.buttons),c=0;c<d.length;c++)!0===a.buttons[d[c]]?a.buttons[d[c]]={text:d[c],updateFields:!0,close:!0,click:A}:!1===a.buttons[d[c]]&&(a.buttons[d[c]]={text:d[c],close:!0,click:A});a.container||(c=document.getElementsByTagName("body"),
a.container=1==c.length?c[0]:null);if(a.container){(c=document.getElementById(a.idPrefix+"wrapper"))&&c.parentElement.removeChild(c);e={options:a,wrapper:u(a.wrapperTemplate,{id:a.idPrefix+"wrapper"})};n(e.wrapper,{visibility:"hidden",position:"fixed"});e.overlay=document.createElement("div");p(e.overlay,{id:a.idPrefix+"overlay"});a.container.appendChild(e.overlay);a.container.appendChild(e.wrapper);n(e.wrapper,{"z-index":50001});n(e.overlay,{visibility:"hidden"});a.headerTemplate&&a.title&&(e.header=
u(a.headerTemplate,{title:a.title,id:a.idPrefix+"header"}),e.wrapper.appendChild(e.header));a.html?(e.content=u(a.contentTemplate,{html:a.html,id:a.idPrefix+"content"}),n(e.content,{"overflow-y":"auto"}),e.wrapper.appendChild(e.content)):a.url&&(e.content=u(a.iframeTemplate,{url:a.url,id:a.idPrefix+"content"}),e.wrapper.appendChild(e.content));if(b||a.buttons)e.footer=u(a.footerTemplate,{id:a.idPrefix+"footer"}),n(e.footer,{position:"absolute"}),e.wrapper.appendChild(e.footer);if(a.buttons){var d=
k(a.buttons),b=O(e.footer,"buttons")?e.footer:e.footer.getElementsByClassName("buttons");b.length&&1==b.length&&(b=b[0]);if(b)for(c=0;c<d.length;c+=1){var g={key:d[c],config:a.buttons[d[c]],bindEvents:!0},f=L(e.options,g);q(a.makeButton)&&(g.elm=f,f=a.makeButton(g));if(!f||1!==f.nodeType){console&&console.error&&console.error("dialogr: makeButton must return a DOM Element");return}b.appendChild(f);f.dialogrButton=d[c].toString();a.buttons[d[c]]._runtime={elm:f};g.bindEvents&&D(f,"click",function(a){var b=
e.options.buttons[a.target.dialogrButton],c={button:t(b,{_runtime:null})};!0===b.updateFields&&q(v)&&(z=v());c.result=z;if(!0===c.button.updateFields&&e.options.fieldArgs){var d=k(e.options.fieldArgs),f;for(f=0;f<d.length;f++){var g=I(e.options.fieldArgs[d[f]]);if("undefined"!==typeof c.result[d[f]]){var h=c.result[d[f]];!g.tagName||"INPUT"!==g.tagName&&"SELECT"!==g.tagName&&"TEXTAREA"!==g.tagName||(g.attributes.type&&"checkbox"===g.attributes.type.value.toLowerCase()?g.checked=h:g.value=h)}}}q(b.click)?
b.click(a,c):q(e.options.click)&&e.options.click(a,c);!0===b.close&&B()})}}n(e.overlay,{position:"fixed",visibility:"visible","background-color":"rgba(0,0,0,0.5)",width:"100%",height:"100%","z-index":5E3,left:0,top:0},!0);C();D(h,"resize",C);n(e.wrapper,{visibility:"visible"});D(document,"keydown",G)}else console&&console.warn&&console.warn("dialogr: Container was not found")},getArgs:function(){if(e){var a={};if(e.options.fieldArgs)for(var c=k(e.options.fieldArgs),b=null,d=0;d<c.length;d++)if(b=
I(e.options.fieldArgs[c[d]])){var g=a,f=c[d];b=!b.tagName||"INPUT"!==b.tagName&&"SELECT"!==b.tagName&&"TEXTAREA"!==b.tagName?null:b.attributes.type&&"checkbox"===b.attributes.type.value.toLowerCase()?b.checked:b.value;g[f]=b}return t(e.options.args,a)}if(y())return h.parent.dialogr.getArgs()},updateDialogResult:function(a){y()?h.parent.dialogr.updateDialogResult(a):(v=null,q(a)?v=a:(z=a,v=function(){return z}))},isOpen:function(){return e?!0:!1},disableButton:function(a){if(y())h.parent.dialogr.disableButton(a);
else if(e.options.buttons){var c=k(e.options.buttons),b;for(b=0;b<c.length;b+=1){var d=e.options.buttons[c[b]]._runtime.elm;if("undefined"===typeof a||a===c[b])p(d,{disabled:"disabled"}),p(d,{"class":"disabled"})}}},enableButton:function(a){if(y())h.parent.dialogr.enableButton(a);else if(e.options.buttons){var c=k(e.options.buttons),b;for(b=0;b<c.length;b+=1){var d=e.options.buttons[c[b]]._runtime.elm;if("undefined"===typeof a||a===c[b])p(d,{disabled:null}),p(d,{"class":null})}}}}}(window);