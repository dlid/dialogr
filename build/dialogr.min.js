!function(e){function t(e){return e=e||"u",A++,("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+A}function n(t,n,i,r){var o,s=L.slice(0);if(n=n||{},z)return o=new I(t,n,{},(!0)),z.invoke("dialogr.open",{optionsOrUrl:t,options:n,newDialogId:o.id,openerId:M}).then(function(t){o.$$e.setDialogrId(o.id),o.$$e.setTargetWindow(e),o.$$e.setNamedTarget("mother",this.messageEvent.source)}),o;if(s.length>0){for(var d=0,u=0;u<s.length;u++){var f=l(a(s[u].$$el.dialog,"z-index"));f>d&&(d=f)}n.zIndex=d+10}return o=new I(t,n,{},i,r)}function r(e){return"undefined"==typeof e}function o(e,t,n){null===e||r(e)||(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n)}function l(e){var t=parseInt(e,10);return isNaN(t)?0:t}function s(e,t){return{t:l(a(e,t+"-top")),r:l(a(e,t+"-right")),b:l(a(e,t+"-bottom")),l:l(a(e,t+"-left"))}}function a(e,t){var n;return window.getComputedStyle?n=document.defaultView.getComputedStyle(e,null).getPropertyValue(t):e.currentStyle&&(n=e.currentStyle[t]),n}function d(e,t){var n;return"function"==typeof e&&(e=e(t)),"string"==typeof e?(n=e.match(/^(\d+)\%$/))?e=Math.ceil(n[1]/100*t)+"px":(n=e.match(/^(\d+)$/))&&(e=parseInt(n[1],10)+"px"):"number"==typeof e?e+="px":e=0,e}function u(t,n,i){var r=new H(null,t,(!0)),o=this,l=w(e.location.href),s=null;return l.params._dialogrId?(s=l.params._dialogrId,r.setDialogrId(s),r.await("dialogr.find-opener",{dialogUrl:window.location.toString(),id:s},t).then(function(t){var i={child:!0,motherIdentified:!0,fatherIdentified:!0,childId:t.dialogrId};if(o.param=t.param||{},M=s,t.opener){i.fatherIdentified=!1,r.setIdentity(i),r.on("dialogr.i-am-your-father",function(e,t,i){r.off("dialogr.i-am-your-father"),r.setNamedTarget("father",i.source),o.unblock(),n(e)});for(var l=e.parent,a=0;a<l.window.frames.length;a++)r.send("dialogr.find-father",{frame:a,childId:s},null,l.window.frames[a])}else r.setIdentity(i),o.unblock(),n(t)},function(e){i(e)}),this.$$e=r,this.$$w=t,this.enable=function(e){},this.disable=function(e){o.trigger("dialogr.disable-button",e)},this.addClass=function(e,t){},this.removeClass=function(e,t){},this.css=function(e,t,n){},this.attr=function(e,t,n){},this.text=function(e,t){o.trigger("dialogr.set-text",{element:e,value:t})},this.html=function(e,t){o.trigger("dialogr.set-html",{element:e,value:t})},this.on=function(e,t){return r.on(e,t),o},this.invoke=function(e,n){return r.await(e,n,null,t)},this.trigger=function(e,n){return r.send(e,n,null,t)},this.close=function(){r.send("dialogr.close")},this.block=function(){r.send("dialogr.block")},this.unblock=function(){r.send("dialogr.unblock")},this.resolve=function(e){r.send("dialogr.resolve",e)},this.reject=function(e){r.send("dialogr.reject",e)},void(this.param={})):void console.error("[dialogr] _dialogrId parameter is missing. Can not create dialog context.")}function f(){var t=E.Deferred();return D=!0,_.done(function(){function n(e){t.resolve(z)}function i(e){t.reject(e)}z=new u(e.parent,n,i)}),t.promise()}function c(e){function t(){n=s(e,"padding"),i=s(e,"border-width"),r=s(e,"margin"),o="border-box"===a(e,"box-sizing"),h="block"===a(e,"display"),o?(f=l(a(e,"width")),c=l(a(e,"height")),d=f-n.l-n.r-r.l-r.r-i.l-i.r,u=c-n.t-n.b-r.t-r.b-i.t-i.b):(f=l(a(e,"width"))+n.l+n.r+r.l+r.r+i.l+i.r,c=l(a(e,"height"))+n.t+n.b+r.t+r.b+i.t+i.b,d=l(a(e,"width")),u=l(a(e,"height")))}var n,i,r,o,d,u,f,c,h;return t(),{width:function(){return h?f:0},height:function(){return h?c:0},innerWidth:function(){return d},innerHeight:function(){return u},padding:n,border:i,margin:r,setWidth:function(s){s=o?l(s):l(s)-n.l-n.r-r.l-r.r-i.l-i.r,e.style.width=s+"px",t()},setHeight:function(s){s=o?l(s):l(s)-n.t-n.b-r.t-r.b-i.t-i.b,e.style.height=s+"px",t()},setTop:function(t){t=l(t),e.style.top=t+"px"},setLeft:function(t){t=l(t),e.style.left=t+"px"}}}function h(e,t,n){for(var i=0;i<L.length;i++)if(L[i].id==e){L[i].trigger(t,n);break}}function g(e,t,n,i){for(var r=0;r<L.length;r++)if(L[r].id==e){L[r].triggerAs(t,n,i);break}}function p(e){for(var t=0;t<L.length;t++)if(L[t].id==e)return L[t].close()}function m(e,t,n,i){for(var r=0;r<L.length;r++)if(L[r].id==e)return L[r].invokeAs(t,n,i)}function y(e,t,n){for(var i=0;i<L.length;i++)if(L[i].id==e)return L[i].invoke(t,n)}function v(){return{open:n,ready:f,close:p,trigger:h,invoke:y,triggerAs:g,invokeAs:m,deferred:function(){return E.Deferred()}}}function b(e){var t=[];for(var n in e.params)e.params.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e.params[n]));return t=t.length>0?"?"+t.join("&"):"",e.url+t+e.hash}function w(e){var t=e.indexOf("?"),n=e.indexOf("#"),i={url:e,hash:"",params:{}};if(n!=-1&&(i.hash=i.url.substring(n),i.url=i.url.substring(0,n)),t!=-1){var r=i.url.substring(t+1).split("&");i.url=i.url.substring(0,t);for(var o=0;o<r.length;o++){var l=r[o].split("=");2==l.length?i.params[l[0]]=l[1]:i.params[l[0]]=""}}return i}function x(e,t){var n=w(e);return n.params=j({},n.params,t),b(n)}function I(n,i,l,s,a){function u(){k(c,f)}var f,c={},h=this,g=null;if("string"==typeof n?((r(i)||"object"!=typeof i)&&(i={}),i.url=n):"object"==typeof n&&(i=n),f=j({},C,i),f.maxWidth=d(f.maxWidth,window.outerWidth),f.minWidth=d(f.minWidth,window.outerWidth),r(f.url))return void console.error("[dialogr] No url was given");var p=!1;s&&s!==!0?this.id=s:($++,this.id="d"+t("dlg")+"_"+$),f.url=x(f.url,{_dialogrId:this.id}),s===!0&&(p=!0),g={father:!1,mother:!1,child:!1},s===!0?(g.father=!0,g.fatherTo=this.id):r(s)?(g.mother=!0,g.motherTo=this.id,g.father=!0,g.fatherTo=this.id):(g.mother=!0,g.motherTo=this.id);var m=E.Deferred(),y=new H(this.id,null,p,a);y.setIdentity(g),g.father?y.on("dialogr.find-father",function(t,n,i){g.fatherTo==t.childId&&(y.setNamedTarget("child",i.source),y.send("dialogr.i-am-your-father",{fatherLocation:e.location.href},null,i.source))}):g.mother&&y.on("dialogr.disable-button",function(e){c.buttons[e]&&c.buttons[e].setAttribute("disabled","disabled")}).on("dialogr.enable-button",function(e){c.buttons[e]&&c.buttons[e].removeAttribute("disabled")}).on("dialogr.set-text",function(e){c.buttons[e.element]&&(c.buttons[e.element].innerText=e.value)}).on("dialogr.set-html",function(e){c.buttons[e.element]&&(c.buttons[e.element].innerHTML=e.value)}),y.on("dialogr.find-opener",function(e,t,n){var i=E.Deferred();return y.setDialogrId(h.id),y.setNamedTarget("dialog",n.source),i.resolve(j({openerUrl:window.location.href.toString(),dialogrId:h.id,param:f.param},{opener:a})),i.promise()}),y.on("dialogr.reject",function(e){m.reject(e),h.close()}),y.on("dialogr.resolve",function(e){m.resolve(e),h.close()}),y.on("dialogr.close",function(e,t,n){h.close()}),y.on("dialogr.block",function(){c.loaderOverlay.style.visibility="visible"}),y.on("dialogr.unblock",function(){c.loaderOverlay.style.visibility="hidden",c.content.style.visibility="visible"}),(!s||s&&s!==!0)&&(y.on("dialogr.open",function(e){var t=E.Deferred();dialogr.open(e.optionsOrUrl,e.options,e.newDialogId,e.openerId);return t.resolve({dialogrId:e.newDialogId}),t.promise()}),c=T(this.id,f),c.addToDom(),setTimeout(function(){k(c,f)},5),o(window,"resize",u),N=!0,c.content.setAttribute("src",f.url)),this.$$e=y,this.$$el=c,this.block=function(){},this.unblock=function(){},this.close=function(){if(g.father&&!g.mother)y.send("dialogr.close");else if(g.mother){for(var e=0;e<L.length;e++)if(L[e].id==h.id){L.splice(e,1);break}c&&c.dialog&&c.dialog.parentNode&&c.overlay&&(c.dialog.parentNode.removeChild(c.dialog),c.overlay.parentNode.removeChild(c.overlay))}},this.always=m.then,this.done=m.done,this.fail=m.fail,this.then=function(e){return m.then(e),h},this.invokeAs=function(e,t,n){return y.await(e,t,null,null,n)},this.triggerAs=function(e,t,n){y.send(e,t,null,null,n)},this.trigger=function(e,t){return y.send(e,t),h},this.invoke=function(e,t){return y.await(e,t)},this.on=function(e,t){return y.on(e,t),h},L.push(this)}function k(e,t){var n=e.dialog,i=e.loaderOverlay,r=e.content,o=e.footer,l=e.loader,s=e.header,a=W(e,t);n.style.width=a.w,n.style.height=a.h,n.style.left=a.l,n.style.top=a.t,i.style.width=a.w,i.style.height=a.h,i.style.left=a.l,i.style.top=a.t;var d=c(n),u=c(s),f=c(r),h=c(o),g=c(l);f.setWidth(d.innerWidth());d.innerHeight()-h.height()-u.height();f.setHeight(d.innerHeight()-h.height()-u.height()),h.setTop(f.height()+u.height()),h.setWidth(d.innerWidth()),g.setTop(d.innerHeight()/2-g.height()/2),g.setLeft(d.innerWidth()/2-g.width()/2)}function W(e,t){var n=d(t.width,window.innerWidth),i=d(t.height,window.innerHeight),r=Math.ceil(window.innerWidth/2-parseInt(n,10)/2)+"px",o=Math.ceil(window.innerHeight/2-parseInt(i,10)/2)+"px",u=n,f=null,c=s(e.dialog,"padding"),h=s(e.dialog,"border-width"),g=s(e.dialog,"margin");return l(t.maxWidth)>0&&l(u)>parseInt(t.maxWidth)&&(n=t.maxWidth,r=Math.ceil(window.innerWidth/2-parseInt(n,10)/2)+"px",f="border-box"!=a(e.dialog,"box-sizing")?l(n)+"px":l(n)-c.r-c.l-h.l-h.r+"px"),"border-box"!=a(e.dialog,"box-sizing")&&(n=l(n)-c.l-c.r-h.l-h.r-g.l-g.r+"px",i=l(i)-c.t-c.b-h.t-h.b-g.t-g.b+"px"),l(u)>window.innerWidth||l(t.minWidth)>0&&l(window.innerWidth)<l(t.minWidth)?(n=window.innerWidth+"px",i=window.innerHeight+"px",r="0px",o="0px",f="border-box"!=a(e.dialog,"box-sizing")?l(n)-c.r+"px":l(n)-c.r-c.l-h.l-h.r+"px"):f="border-box"!=a(e.dialog,"box-sizing")?l(n)+"px":l(n)-c.r-c.l-h.l-h.r+"px",{w:n,h:i,l:r,t:o,iw:f}}function T(e,t){function n(t,n){var i=document.createElement("button");return i.setAttribute("id","button_"+e+"_"+t),i.setAttribute("onclick",'javascript:dialogr.trigger("'+e+'", "button_'+t+'");'),i.setAttribute("class","dialogr__button button_"+t),i.innerHTML=n,i}var o,l,s,a,d,u,f,c=[];o=document.createElement("div"),o.setAttribute("class",t.className),o.style.position="fixed",o.style.zIndex=t.zIndex,o.style.display="block",l=document.createElement("div"),l.setAttribute("data-dialogr-id",e),l.setAttribute("class",t.className+"__overlay"),l.style.position="fixed",l.style.width="100%",l.style.backgroundColor="rgba(0,0,0,0.5)",l.style.height="100%",l.style.top="0",l.style.left="0",l.style.zIndex=o.style.zIndex-10,s=document.createElement("iframe"),s.setAttribute("class",t.className+"__content"),s.style.position="absolute",s.style.display="block",s.style.visibility="hidden",a=document.createElement("div"),a.setAttribute("class",t.className+"__loader-overlay"),a.style.position="fixed",a.style.border="1px solid #aaa",a.style.backgroundColor="rgba(255,255,255,0.8)",a.style.cursor="wait",a.style.display="block",d=document.createElement("div"),d.setAttribute("class",t.className+"__overlay"),d.style.position="absolute",d.style.backgroundColor="#fff",a.style.visibility="visible",a.style.display="block",d.innerHTML="Loading...",d.style.display="block",u=document.createElement("div"),u.setAttribute("class",t.className+"__footer"),u.style.position="absolute",u.style.display="block",f=document.createElement("div"),f.setAttribute("class",t.className+"__header"),f.style.overflow="hidden",f.style.display="block";var h,g,p=0;if(!r(t.buttons))if(t.buttons.constructor===Array)for(i=0;i<t.buttons.length;i++)h=n(i,t.buttons[i]),u.appendChild(h),c["button_"+i]=h,p++;else if("object"==typeof t.buttons)for(g in t.buttons)t.buttons.hasOwnProperty(g)&&(h=n(g,t.buttons[i]),u.appendChild(h),c["button_"+g]=h,p++);return 0===p&&(u.style.display="none"),t.title?f.innerHTML="<a href='javascript:dialogr.close(\""+e+"\")'>x</a><h1>"+t.title+"</h1>":f.style.display="none",o.appendChild(f),o.appendChild(s),o.appendChild(u),a.appendChild(d),o.appendChild(a),{overlay:l,loaderOverlay:a,loader:d,dialog:o,header:f,footer:u,content:s,buttons:c,destroy:function(){},addToDom:function(){document.body.appendChild(o),document.body.appendChild(l)}}}function j(e){return Array.prototype.slice.call(arguments,1).forEach(function(t){if(t)for(var n in t)null===t[n]||"undefined"==typeof t[n]?delete e[n]:t[n].constructor===Object?e[n]&&e[n].constructor!==Object?e[n]=t[n]:(e[n]=e[n]||{},j(e[n],t[n])):e[n]=t[n]}),e}var _,C={zIndex:1500,url:null,className:"dialogr",width:"90%",height:"60%",title:null,buttons:["Ok","Cancel"],init:function(e){var t=document.createElement("div");t.style.backgroundColor="yellow",t.innerHTML="<p>hejsan alla glada</p>",e.parentNode.appendChild(t)},param:null,maxWidth:null,minWidth:600},A=0,N=null,D=!1,O=null,$=null,E=this;!function(e){function t(e){return"[object Array]"===Object.prototype.toString.call(e)}function n(e,n){if(t(e))for(var i=0;i<e.length;i++)n(e[i]);else n(e)}function i(e){var r="pending",o=[],l=[],s=[],a=null,d={done:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(t(arguments[e]))for(var n=arguments[e],i=0;i<n.length;i++)"resolved"===r&&n[i].apply(this,a),o.push(n[i]);else"resolved"===r&&arguments[e].apply(this,a),o.push(arguments[e]);return this},fail:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(t(arguments[e]))for(var n=arguments[e],i=0;i<n.length;i++)"rejected"===r&&n[i].apply(this,a),l.push(n[i]);else"rejected"===r&&arguments[e].apply(this,a),l.push(arguments[e]);return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(t(arguments[e]))for(var n=arguments[e],i=0;i<n.length;i++)"pending"===r&&s.push(n[i]);else"pending"===r&&s.push(arguments[e]);return this},then:function(){arguments.length>1&&arguments[1]&&this.fail(arguments[1]),arguments.length>0&&arguments[0]&&this.done(arguments[0]),arguments.length>2&&arguments[2]&&this.progress(arguments[2])},promise:function(e){if(null==e)return d;for(var t in d)e[t]=d[t];return e},state:function(){return r},debug:function(){console.log("[debug]",o,l,r)},isRejected:function(){return"rejected"===r},isResolved:function(){return"resolved"===r},pipe:function(e,t,r){return i(function(i){n(e,function(e){"function"==typeof e?u.done(function(){var t=e.apply(this,arguments);t&&"function"==typeof t?t.promise().then(i.resolve,i.reject,i.notify):i.resolve(t)}):u.done(i.resolve)}),n(t,function(e){"function"==typeof e?u.fail(function(){var t=e.apply(this,arguments);t&&"function"==typeof t?t.promise().then(i.resolve,i.reject,i.notify):i.reject(t)}):u.fail(i.reject)})}).promise()}},u={resolveWith:function(e){if("pending"===r){r="resolved";for(var t=a=arguments.length>1?arguments[1]:[],n=0;n<o.length;n++)o[n].apply(e,t)}return this},rejectWith:function(e){if("pending"===r){r="rejected";for(var t=a=arguments.length>1?arguments[1]:[],n=0;n<l.length;n++)l[n].apply(e,t)}return this},notifyWith:function(e){if("pending"===r)for(var t=a=arguments.length>1?arguments[1]:[],n=0;n<s.length;n++)s[n].apply(e,t);return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}},f=d.promise(u);return e&&e.apply(f,[f]),f}i.when=function(){if(arguments.length<2){var e=arguments.length?arguments[0]:void 0;return e&&"function"==typeof e.isResolved&&"function"==typeof e.isRejected?e.promise():i().resolve(e).promise()}return function(e){for(var t=i(),n=e.length,r=0,o=new Array(n),l=0;l<e.length;l++)!function(i){var l=null;e[i].done?e[i].done(function(){o[i]=arguments.length<2?arguments[0]:arguments,++r==n&&t.resolve.apply(t,o)}).fail(function(){t.reject(arguments)}):(l=e[i],e[i]=new Deferred,e[i].done(function(){o[i]=arguments.length<2?arguments[0]:arguments,++r==n&&t.resolve.apply(t,o)}).fail(function(){t.reject(arguments)}).resolve(l))}(l);return t.promise()}(arguments)},e.Deferred=i}(this);var H=function(n,i,l,s){function a(e,t){return r(x[e])&&(x[e]=[]),x[e].push(t),this}function d(e,t){return this}function u(t,n,i,r,o){var l="undefined"!=typeof r&&null!==r;i=j({await:null,messageId:null},i||{}),i.messageId||(b++,i.messageId=w+"_"+b);var s="mother",a=["dialogr.close","dialogr.block","dialogr.unblock","dialogr.open"];l?s="custom target window":null!==W&&(W.child?a.indexOf(t)===-1&&(s="father"):!W.mother&&W.father&&a.indexOf(t)!==-1?s="mother":(W.mother||W.father)&&(s="dialog"));var d={direction:k,source:"dialogr",messageType:t,messageData:n,messageId:i.messageId,dialogrId:o?o:I,await:i.await,fromLocation:e.location.href},u=l?r:T[s];return"undefined"==typeof u||null===u?void console.error("Target window was null or undefined",s):void u.postMessage(JSON.stringify(d),"*")}function f(e){function t(t){f++,"fail"===t.type&&(g=!1),c.push(t),f===d.length&&(clearTimeout(h),u(l.messageId+"_response",{type:g?"success":"fail",response:c},null,e.source))}function i(e){h&&t({index:s,type:"success",data:e})}function o(e){h&&t({index:s,type:"fail",data:e})}if(e.source!=window){var l,s,a;try{l=JSON.parse(e.data)}catch(e){}if(l&&!r(l.source)&&"dialogr"===l.source){if(I){if(I!==l.dialogrId)return}else if(l.messageType.indexOf("dialogr.find-opener")===-1)return;if(r(x[l.messageType]))l.await&&(console.warn("no handlers in",n,x,window.location),u(l.messageId+"_response",{type:"fail",response:["Nothing listening for '"+l.messageType+"'"]},null,e.source));else if(l.await){var d=x[l.messageType].slice(0),f=0,c=[],h=null,g=!0;for(h=setTimeout(function(){u(l.messageId+"_response",{type:"fail",response:["Operation took too long > "+l.await+"ms"]},null,e.source)},l.await),s=0;s<d.length;s++)if(a=d[s](l.messageData,l,e),l.await)if(a&&a.done&&a.fail&&a.promise)a.then(i,o);else{if(!h)return;t({apa:3,index:s,type:"success",data:a})}}else for(s=0;s<x[l.messageType].length;s++)a=x[l.messageType][s](l.messageData,l,e)}}}function c(e,t,n,i,r){var o=E.Deferred();n=j({await:5e3},n||{}),b++,n.messageId=e+"://await"+w+b,a(n.messageId+"_response",function(e,t,n){for(var i=[],r=0;r<e.response.length;r++)"string"==typeof e.response[r]?i.push(e.response[r]):e.response[r].data&&i.push(e.response[r].data);var l={messageEvent:n,message:t};"fail"===e.type?o.rejectWith(l,[1==i.length?i[0]:i]):o.resolveWith(l,[1==i.length?i[0]:i])});u(e,t,n,i,r);return o.promise()}function h(e){I=e}function g(e){y=e}function p(e){v=e}function m(e,t){"father"==e&&(W.fatherIdentified=!0),T[e]=t}var y=i||null,v=null,b=0,w=t("m"),x={},I=null,k="",W=null,T={mother:i||null,father:i||null,child:null};return o(window,"message",f),k=null===i?"opener=>dialog":"dialog=>opener",{send:u,await:c,setDialogrId:h,setTargetWindow:g,setEventingTargetWindow:p,setNamedTarget:m,on:a,off:d,handleMessage:f,$$eventHandlers:x,setIdentity:function(e){W=e}}};o(e,"keydown",function(e){27===e.keyCode&&null!==O&&p()});var z=null,M=null,L=[];_=this.Deferred(),"complete"===document.readyState?_.resolve():o(window,"load",function(){_.resolve()}),e.dialogr=v()}(window);