/*! dialogr v0.0.8 © 2016 David Lidström. https://docs.dlid.se/dialogr License: MIT */
!function(e){function t(e){return"undefined"==typeof e}function n(e){return e=e||"u",z++,("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+z}function r(e){var t=parseInt(e,10);return isNaN(t)?0:t}function o(e){return Array.prototype.slice.call(arguments,1).forEach(function(n){if(n)for(var i in n)null===n[i]||t(n[i])?delete e[i]:n[i].constructor===Object?e[i]&&e[i].constructor!==Object?e[i]=n[i]:(e[i]=e[i]||{},o(e[i],n[i])):e[i]=n[i]}),e}function s(e){var t=[];for(var n in e.params)e.params.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e.params[n]));return t=t.length>0?"?"+t.join("&"):"",e.url+t+e.hash}function l(e){var t=e.indexOf("?"),n=e.indexOf("#"),i={url:e,hash:"",params:{}};if(n!=-1&&(i.hash=i.url.substring(n),i.url=i.url.substring(0,n)),t!=-1){var r=i.url.substring(t+1).split("&");i.url=i.url.substring(0,t);for(var o=0;o<r.length;o++){var s=r[o].split("=");2==s.length?i.params[s[0]]=s[1]:i.params[s[0]]=""}}return i}function a(e,t){var n=l(e);return n.params=o({},n.params,t),s(n)}function u(e,n,i){null===e||t(e)||(e.addEventListener?e.addEventListener(n,i,!1):e.attachEvent?e.attachEvent("on"+n,i):e["on"+n]=i)}function d(e,t){return{t:r(f(e,t+"-top")),r:r(f(e,t+"-right")),b:r(f(e,t+"-bottom")),l:r(f(e,t+"-left"))}}function f(e,t){var n;return window.getComputedStyle?n=document.defaultView.getComputedStyle(e,null).getPropertyValue(t):e.currentStyle&&(n=e.currentStyle[t]),n}function h(e,t){var n,i=v(t);for(n=0;n<i.length;n++)e.style[i[n]]=t[i[n]];return e}function c(e,t){var n=0;for(n=0;n<t.length;n++)e.appendChild(t[n])}function g(e,t){var n,i=v(t);for(n=0;n<i.length;n++)e.setAttribute(i[n],t[i[n]]);return e}function p(e,t){return e.innerHTML=t,e}function v(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push(t);return n}function m(e,t){return document.createElement(e,t)}function b(e){function t(){n=d(e,"padding"),i=d(e,"border-width"),o=d(e,"margin"),s="border-box"===f(e,"box-sizing"),c="block"===f(e,"display"),s?(u=r(f(e,"width")),h=r(f(e,"height")),l=u-n.l-n.r-o.l-o.r-i.l-i.r,a=h-n.t-n.b-o.t-o.b-i.t-i.b):(u=r(f(e,"width"))+n.l+n.r+o.l+o.r+i.l+i.r,h=r(f(e,"height"))+n.t+n.b+o.t+o.b+i.t+i.b,l=r(f(e,"width")),a=r(f(e,"height")))}var n,i,o,s,l,a,u,h,c;return t(),{width:function(){return c?u:0},height:function(){return c?h:0},innerWidth:function(){return l},innerHeight:function(){return a},padding:n,border:i,margin:o,setWidth:function(l){l=s?r(l):r(l)-n.l-n.r-o.l-o.r-i.l-i.r,e.style.width=l+F,t()},setHeight:function(l){l=s?r(l):r(l)-n.t-n.b-o.t-o.b-i.t-i.b,e.style.height=l+F,t()},setTop:function(t){t=r(t),e.style.top=t+F},setLeft:function(t){t=r(t),e.style.left=t+F}}}function y(e,t){var n;return"function"==typeof e&&(e=e(t)),"string"==typeof e?(n=e.match(/^(\d+)\%$/))?e=Math.ceil(n[1]/100*t)+F:(n=e.match(/^(\d+)$/))&&(e=parseInt(n[1],10)+F):"number"==typeof e?e+=F:e=0,e}function w(e,t){var n=e.dialog,i=e.p,r=e.content,o=e.footer,s=e.loader,l=e.header,a=$(e,t);n.style.width=a.w,n.style.height=a.h,n.style.left=a.l,n.style.top=a.t,i.style.width=a.w,i.style.height=a.h,i.style.left=a.l,i.style.top=a.t;var u=b(n),d=b(l),f=b(r),h=b(o),c=b(s);f.setWidth(u.innerWidth());u.innerHeight()-h.height()-d.height();f.setHeight(u.innerHeight()-h.height()-d.height()),h.setTop(f.height()+d.height()),h.setWidth(u.innerWidth()),c.setTop(u.innerHeight()/2-c.height()/2),c.setLeft(u.innerWidth()/2-c.width()/2)}function $(e,t){var n=y(t.width,window.innerWidth),i=y(t.height,window.innerHeight),o=Math.ceil(window.innerWidth/2-parseInt(n,10)/2)+F,s=Math.ceil(window.innerHeight/2-parseInt(i,10)/2)+F,l=n,a=i,u=null,h=d(e.dialog,"padding"),c=d(e.dialog,"border-width"),g=d(e.dialog,"margin");return r(t.maxWidth)>0&&r(l)>parseInt(t.maxWidth)&&(n=t.maxWidth,o=Math.ceil(window.innerWidth/2-parseInt(n,10)/2)+F,u="border-box"!=f(e.dialog,"box-sizing")?r(n)+F:r(n)-h.r-h.l-c.l-c.r+F),"border-box"!=f(e.dialog,"box-sizing")&&(n=r(n)-h.l-h.r-c.l-c.r-g.l-g.r+F,i=r(i)-h.t-h.b-c.t-c.b-g.t-g.b+F),r(l)>window.innerWidth||r(a)>window.innerHeight||r(t.minWidth)>0&&r(window.innerWidth)<r(t.minWidth)||r(t.minHeight)>0&&r(window.innerHeight)<r(t.minHeight)?(n=window.innerWidth+F,i=window.innerHeight+F,o=0,s=0,u="border-box"!=f(e.dialog,"box-sizing")?r(n)-h.r+F:r(n)-h.r-h.l-c.l-c.r+F):u="border-box"!=f(e.dialog,"box-sizing")?r(n)+F:r(n)-h.r-h.l-c.l-c.r+F,{w:n,h:i,l:o,t:s,iw:u}}function I(e,r){function o(t,n){return p(g(m("button"),{id:"button_"+e+"_"+t,onclick:'dialogr.trigger("'+e+'", "button_'+t+'");',class:"dialogr__button button_"+t}),n)}var s,l,a,u,d,f,b,y=[],w=r.className;s=h(g(m(G),{class:w,id:n()}),{position:V,zIndex:r.zIndex,display:J}),l=g(h(m(G),{position:V,width:"100%",backgroundColor:"rgba(0,0,0,0.5)",height:"100%",top:0,left:0,zIndex:s.style.zIndex-10}),{"data-dialogr-id":e,class:w+"__overlay"}),a=h(g(m("iframe"),{class:w+"__content"}),{position:q,display:J,visibility:B}),u=h(g(m(G),{class:w+"__loader-overlay"}),{position:V,border:"1px solid #aaa",backgroundColor:"rgba(255,255,255,0.8)",cursor:"wait",display:J,visibility:"visible"}),d=p(h(g(m(G),{class:w+"__overlay"}),{position:q,backgroundColor:"#fff",display:J}),"Loading..."),f=h(g(m(G),{class:w+"__footer"}),{position:q,display:J}),b=h(g(m(G),{class:w+"__header"}),{overflow:B,display:J});var $,I,x=0;if(!t(r.buttons))if(r.buttons.constructor===Array)for(i=0;i<r.buttons.length;i++)$=o(i,r.buttons[i]),c(f,[$]),y["button_"+i]=$,x++;else if("object"==typeof r.buttons)for(I=v(r.buttons),i=0;i<I.length;i++)$=o(I[i],r.buttons[I[i]].text),c(f,[$]),y["button_"+I[i]]=$,x++;return 0===x&&h(f,{display:"none"}),r.title?p(b,"<a href='javascript:dialogr.close(\""+e+"\")'>x</a><h1>"+r.title+"</h1>"):h(f,{display:J}),c(u,[d]),c(s,[b,a,f,u]),{o:l,p:u,loader:d,dialog:s,header:b,footer:f,content:a,buttons:y,destroy:function(){},addToDom:function(){c(document.body,[s,l])}}}function x(i,r,s,l,d){function f(){w(c,h)}var h,c={},g=this,p=null;if("string"==typeof i?((t(r)||"object"!=typeof r)&&(r={}),r.url=i):"object"==typeof i&&(r=i),h=o({},A,r),h.maxWidth=y(h.maxWidth,window.outerWidth),h.minWidth=y(h.minWidth,window.outerWidth),t(h.url))return void console.error("[dialogr] No url was given");var v=!1;l&&l!==!0?this.id=l:(E++,this.id="d"+n("dlg")+"_"+E),h.url=a(h.url,{_dialogrId:this.id}),l===!0&&(v=!0),p={father:!1,mother:!1,child:!1},l===!0?(p.father=!0,p.fatherTo=this.id):t(l)?(p.mother=!0,p.motherTo=this.id,p.father=!0,p.fatherTo=this.id):(p.mother=!0,p.motherTo=this.id);var m=R.Deferred(),b=new K(this.id,null,v,d);b.setIdentity(p),p.father?b.on("$f",function(t,n,i){p.fatherTo==t.childId&&(b.setNamedTarget("child",i.source),b.send("$k",{fatherLocation:e.location.href},null,i.source))}):p.mother&&b.on("$h",function(e){c.buttons[e]&&c.buttons[e].setAttribute("disabled","disabled")}).on("$i",function(e){c.buttons[e]&&c.buttons[e].removeAttribute("disabled")}).on("$a",function(e){c.buttons[e.element]&&(c.buttons[e.element].innerText=e.value)}).on("$g",function(e){c.buttons[e.element]&&(c.buttons[e.element].innerHTML=e.value)}).on("$l",function(e){c.buttons[e.element]&&(c.buttons[e.element].innerHTML=e.value)}),b.on("$o",function(e,t,n){var i=R.Deferred();return b.setDialogrId(g.id),b.setNamedTarget("dialog",n.source),i.resolve(o({openerUrl:window.location.href.toString(),dialogrId:g.id,param:h.param},{opener:d})),i.promise()}),b.on("$e",function(e){m.reject(e),g.close()}),b.on("$j",function(e){m.resolve(e),g.close()}),b.on("$c",function(e,t,n){g.close()}),b.on("$b",function(){c.p.style.visibility="visible"}),b.on("$m",function(){c.p.style.visibility="hidden",c.content.style.visibility="visible"}),(!l||l&&l!==!0)&&(b.on("$n",function(e){var t=R.Deferred();dialogr.open(e.optionsOrUrl,e.options,e.newDialogId,e.openerId);return t.resolve({dialogrId:e.newDialogId}),t.promise()}),c=I(this.id,h),c.addToDom(),setTimeout(function(){w(c,h)},5),u(window,"resize",f),M=!0,c.content.setAttribute("src",h.url)),this.$$e=b,this.$$el=c,this.block=function(){},this.unblock=function(){},this.close=function(){if(p.father&&!p.mother)b.send("$c");else if(p.mother){for(var e=0;e<Q.length;e++)if(Q[e].id==g.id){Q.splice(e,1);break}c&&c.dialog&&c.dialog.parentNode&&c.o&&(c.dialog.parentNode.removeChild(c.dialog),c.o.parentNode.removeChild(c.o))}},this.always=m.then,this.done=m.done,this.fail=m.fail,this.then=function(e){return m.then(e),g},this.invokeAs=function(e,t,n){return b.await(e,t,null,null,n)},this.triggerAs=function(e,t,n){b.send(e,t,null,null,n)},this.trigger=function(e,t){return b.send(e,t),g},this.invoke=function(e,t){return b.await(e,t)},this.on=function(e,t){return b.on(e,t),g},Q.push(this)}function W(t,n,i){var r=new K(null,t,(!0)),o=this,s=l(e.location.href),a=null;return s.params._dialogrId?(a=s.params._dialogrId,r.setDialogrId(a),r.await("$o",{dialogUrl:window.location.toString(),id:a},t).then(function(t){var i={child:!0,motherIdentified:!0,fatherIdentified:!0,childId:t.dialogrId};if(o.param=t.param||{},P=a,t.opener){i.fatherIdentified=!1,r.setIdentity(i),r.on("$k",function(e,t,i){r.off("$k"),r.setNamedTarget("father",i.source),o.unblock(),n(e)});for(var s=e.parent,l=0;l<s.window.frames.length;l++)r.send("$f",{frame:l,childId:a},null,s.window.frames[l])}else r.setIdentity(i),o.unblock(),n(t)},function(e){i(e)}),this.$$e=r,this.$$w=t,this.enable=function(e){},this.disable=function(e){o.trigger("$h",e)},this.addClass=function(e,t){},this.removeClass=function(e,t){},this.css=function(e,t,n){},this.attr=function(e,t,n){},this.text=function(e,t){o.trigger("$a",{element:e,value:t})},this.html=function(e,t){o.trigger("$g",{element:e,value:t})},this.on=function(e,t){return r.on(e,t),o},this.invoke=function(e,n){return r.await(e,n,null,t)},this.trigger=function(e,n){return r.send(e,n,null,t)},this.close=function(){r.send("$c")},this.block=function(){r.send("$b")},this.unblock=function(){r.send("$m")},this.resolve=function(e){r.send("$j",e)},this.reject=function(e){r.send("$e",e)},this.buttons=function(e){r.send("$l",e)},void(this.param={})):void console.error("[dialogr] _dialogrId parameter is missing. Can not create dialog context.")}function T(e,t,n){for(var i=0;i<Q.length;i++)if(Q[i].id==e){Q[i].trigger(t,n);break}}function j(e,t,n,i){for(var r=0;r<Q.length;r++)if(Q[r].id==e){Q[r].triggerAs(t,n,i);break}}function k(e){for(var t=0;t<Q.length;t++)if(Q[t].id==e)return Q[t].close()}function _(e,t,n,i){for(var r=0;r<Q.length;r++)if(Q[r].id==e)return Q[r].invokeAs(t,n,i)}function D(e,t,n){for(var i=0;i<Q.length;i++)if(Q[i].id==e)return Q[i].invoke(t,n)}function H(t,n,i,o){var s,l=Q.slice(0);if(n=n||{},U)return s=new x(t,n,{},(!0)),U.invoke("$n",{optionsOrUrl:t,options:n,newDialogId:s.id,openerId:P}).then(function(t){s.$$e.setDialogrId(s.id),s.$$e.setTargetWindow(e),s.$$e.setNamedTarget("mother",this.messageEvent.source)}),s;if(l.length>0){for(var a=0,u=0;u<l.length;u++){var d=r(f(l[u].$$el.dialog,"z-index"));d>a&&(a=d)}n.zIndex=a+10}return s=new x(t,n,{},i,o)}function O(){var t=R.Deferred();return S=!0,C.done(function(){function n(e){t.resolve(U)}function i(e){t.reject(e)}U=new W(e.parent,n,i)}),t.promise()}function N(){return u(e,"keydown",function(e){27===e.keyCode&&null!==L&&k()}),{open:H,ready:O,close:k,trigger:T,invoke:D,triggerAs:j,invokeAs:_,deferred:function(){return R.Deferred()}}}var C,A={zIndex:1500,url:null,className:"dialogr",width:"90%",height:"60%",title:null,buttons:["Ok","Cancel"],param:null,maxWidth:null,minWidth:600},z=0,M=null,S=!1,L=null,E=null,R=this,U=null,P=null,J="block",V="fixed",q="absolute",B="hidden",F="px",G="div";!function(e){function t(e){return"[object Array]"===Object.prototype.toString.call(e)}function n(e,n){if(t(e))for(var i=0;i<e.length;i++)n(e[i]);else n(e)}function i(e){var r="pending",o=[],s=[],l=[],a=null,u={done:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(t(arguments[e]))for(var n=arguments[e],i=0;i<n.length;i++)"resolved"===r&&n[i].apply(this,a),o.push(n[i]);else"resolved"===r&&arguments[e].apply(this,a),o.push(arguments[e]);return this},fail:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(t(arguments[e]))for(var n=arguments[e],i=0;i<n.length;i++)"rejected"===r&&n[i].apply(this,a),s.push(n[i]);else"rejected"===r&&arguments[e].apply(this,a),s.push(arguments[e]);return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(t(arguments[e]))for(var n=arguments[e],i=0;i<n.length;i++)"pending"===r&&l.push(n[i]);else"pending"===r&&l.push(arguments[e]);return this},then:function(){arguments.length>1&&arguments[1]&&this.fail(arguments[1]),arguments.length>0&&arguments[0]&&this.done(arguments[0]),arguments.length>2&&arguments[2]&&this.progress(arguments[2])},promise:function(e){if(null==e)return u;for(var t in u)e[t]=u[t];return e},state:function(){return r},debug:function(){console.log("[debug]",o,s,r)},isRejected:function(){return"rejected"===r},isResolved:function(){return"resolved"===r},pipe:function(e,t,r){return i(function(i){n(e,function(e){"function"==typeof e?d.done(function(){var t=e.apply(this,arguments);t&&"function"==typeof t?t.promise().then(i.resolve,i.reject,i.notify):i.resolve(t)}):d.done(i.resolve)}),n(t,function(e){"function"==typeof e?d.fail(function(){var t=e.apply(this,arguments);t&&"function"==typeof t?t.promise().then(i.resolve,i.reject,i.notify):i.reject(t)}):d.fail(i.reject)})}).promise()}},d={resolveWith:function(e){if("pending"===r){r="resolved";for(var t=a=arguments.length>1?arguments[1]:[],n=0;n<o.length;n++)o[n].apply(e,t)}return this},rejectWith:function(e){if("pending"===r){r="rejected";for(var t=a=arguments.length>1?arguments[1]:[],n=0;n<s.length;n++)s[n].apply(e,t)}return this},notifyWith:function(e){if("pending"===r)for(var t=a=arguments.length>1?arguments[1]:[],n=0;n<l.length;n++)l[n].apply(e,t);return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}},f=u.promise(d);return e&&e.apply(f,[f]),f}i.when=function(){if(arguments.length<2){var e=arguments.length?arguments[0]:void 0;return e&&"function"==typeof e.isResolved&&"function"==typeof e.isRejected?e.promise():i().resolve(e).promise()}return function(e){for(var t=i(),n=e.length,r=0,o=new Array(n),s=0;s<e.length;s++)!function(i){var s=null;e[i].done?e[i].done(function(){o[i]=arguments.length<2?arguments[0]:arguments,++r==n&&t.resolve.apply(t,o)}).fail(function(){t.reject(arguments)}):(s=e[i],e[i]=new Deferred,e[i].done(function(){o[i]=arguments.length<2?arguments[0]:arguments,++r==n&&t.resolve.apply(t,o)}).fail(function(){t.reject(arguments)}).resolve(s))}(s);return t.promise()}(arguments)},e.Deferred=i}(this);var K=function(i,r,s,l){function a(e,n){return t(I[e])&&(I[e]=[]),I[e].push(n),this}function d(e,t){return this}function f(t,n,i,r,s){var l="undefined"!=typeof r&&null!==r;i=o({await:null,messageId:null},i||{}),i.messageId||(w++,i.messageId=$+"_"+w);var a="mother",u=["$c","$b","$m","$n"];l?a="custom target window":null!==W&&(W.child?u.indexOf(t)===-1&&(a="father"):!W.mother&&W.father&&u.indexOf(t)!==-1?a="mother":(W.mother||W.father)&&(a="dialog"));var d={source:"dialogr",messageType:t,messageData:n,messageId:i.messageId,dialogrId:s?s:x,await:i.await,fromLocation:e.location.href},f=l?r:T[a];return"undefined"==typeof f||null===f?void console.error("Target window was null or undefined",a):void f.postMessage(JSON.stringify(d),"*")}function h(e){function n(t){d++,"fail"===t.type&&(g=!1),h.push(t),d===u.length&&(clearTimeout(c),f(s.messageId+"_response",{type:g?"success":"fail",response:h},null,e.source))}function r(e){c&&n({index:l,type:"success",data:e})}function o(e){c&&n({index:l,type:"fail",data:e})}if(e.source!=window){var s,l,a;try{s=JSON.parse(e.data)}catch(e){}if(s&&!t(s.source)&&"dialogr"===s.source){if(x){if(x!==s.dialogrId)return}else if(s.messageType.indexOf("$o")===-1)return;if(t(I[s.messageType]))s.await&&(console.warn("no handlers in",i,I,window.location),f(s.messageId+"_response",{type:"fail",response:["Nothing listening for '"+s.messageType+"'"]},null,e.source));else if(s.await){var u=I[s.messageType].slice(0),d=0,h=[],c=null,g=!0;for(c=setTimeout(function(){f(s.messageId+"_response",{type:"fail",response:["Operation took too long > "+s.await+"ms"]},null,e.source)},s.await),l=0;l<u.length;l++)if(a=u[l](s.messageData,s,e),s.await)if(a&&a.done&&a.fail&&a.promise)a.then(r,o);else{if(!c)return;n({apa:3,index:l,type:"success",data:a})}}else for(l=0;l<I[s.messageType].length;l++)a=I[s.messageType][l](s.messageData,s,e)}}}function c(e,t,n,i,r){var s=R.Deferred();n=o({await:5e3},n||{}),w++,n.messageId=e+"://await"+$+w,a(n.messageId+"_response",function(e,t,n){for(var i=[],r=0;r<e.response.length;r++)"string"==typeof e.response[r]?i.push(e.response[r]):e.response[r].data&&i.push(e.response[r].data);var o={messageEvent:n,message:t};"fail"===e.type?s.rejectWith(o,[1==i.length?i[0]:i]):s.resolveWith(o,[1==i.length?i[0]:i])});f(e,t,n,i,r);return s.promise()}function g(e){x=e}function p(e){b=e}function v(e){y=e}function m(e,t){"father"==e&&(W.fatherIdentified=!0),T[e]=t}var b=r||null,y=null,w=0,$=n("m"),I={},x=null,W=null,T={mother:r||null,father:r||null,child:null};return u(window,"message",h),{send:f,await:c,setDialogrId:g,setTargetWindow:p,setEventingTargetWindow:v,setNamedTarget:m,on:a,off:d,handleMessage:h,$$eventHandlers:I,setIdentity:function(e){W=e}}},Q=[];C=R.Deferred(),"complete"===document.readyState?C.resolve():u(window,"load",function(){C.resolve()}),e.dialogr=N()}(window);