/*! dialogr v0.0.8 © 2016 David Lidström (MIT license, https://docs.dlid.se/dialogr)*/
!function(e){function n(e){return e=e||"u",y++,("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+y}function t(n,t,r,i){var a,l=T.slice(0);if(t=t||{},k)return a=new DialogrDialog(n,t,{},(!0)),k.invoke("dialogr.open",{optionsOrUrl:n,options:t,newDialogId:a.id,openerId:D}).then(function(n){a.$$e.setDialogrId(a.id),a.$$e.setTargetWindow(e),a.$$e.setNamedTarget("mother",this.messageEvent.source)}),a;if(l.length>0){for(var u=0,f=0;f<l.length;f++){var d=o(s(l[f].$$el.dialog,"z-index"));d>u&&(u=d)}t.zIndex=u+10}return a=new DialogrDialog(n,t,{},r,i)}function r(e){return"undefined"==typeof e}function i(e,n,t){null===e||r(e)||(e.addEventListener?e.addEventListener(n,t,!1):e.attachEvent?e.attachEvent("on"+n,t):e["on"+n]=t)}function o(e){var n=parseInt(e,10);return isNaN(n)?0:n}function s(e,n){var t;return window.getComputedStyle?t=document.defaultView.getComputedStyle(e,null).getPropertyValue(n):e.currentStyle&&(t=e.currentStyle[n]),t}function a(n,t,r){var i=new j(null,n,(!0)),o=this,s=p(e.location.href),a=null;return s.params._dialogrId?(a=s.params._dialogrId,i.setDialogrId(a),i.await("dialogr.find-opener",{dialogUrl:window.location.toString(),id:a},n).then(function(n){var r={child:!0,motherIdentified:!0,fatherIdentified:!0,childId:n.dialogrId};if(o.param=n.param||{},D=a,n.opener){r.fatherIdentified=!1,i.setIdentity(r),i.on("dialogr.i-am-your-father",function(e,n,r){i.off("dialogr.i-am-your-father"),i.setNamedTarget("father",r.source),o.unblock(),t(e)});for(var s=e.parent,l=0;l<s.window.frames.length;l++)i.send("dialogr.find-father",{frame:l,childId:a},null,s.window.frames[l])}else i.setIdentity(r),o.unblock(),t(n)},function(e){r(e)}),this.$$e=i,this.$$w=n,this.enable=function(e){},this.disable=function(e){o.trigger("dialogr.disable-button",e)},this.addClass=function(e,n){},this.removeClass=function(e,n){},this.css=function(e,n,t){},this.attr=function(e,n,t){},this.text=function(e,n){o.trigger("dialogr.set-text",{element:e,value:n})},this.html=function(e,n){o.trigger("dialogr.set-html",{element:e,value:n})},this.on=function(e,n){return i.on(e,n),o},this.invoke=function(e,t){return i.await(e,t,null,n)},this.trigger=function(e,t){return i.send(e,t,null,n)},this.close=function(){i.send("dialogr.close")},this.block=function(){i.send("dialogr.block")},this.unblock=function(){i.send("dialogr.unblock")},this.resolve=function(e){i.send("dialogr.resolve",e)},this.reject=function(e){i.send("dialogr.reject",e)},void(this.param={})):void console.error("[dialogr] _dialogrId parameter is missing. Can not create dialog context.")}function l(){var n=b.Deferred();return w=!0,m.done(function(){function t(e){n.resolve(k)}function r(e){n.reject(e)}k=new a(e.parent,t,r)}),n.promise()}function u(e,n,t){for(var r=0;r<T.length;r++)if(T[r].id==e){T[r].trigger(n,t);break}}function f(e,n,t,r){for(var i=0;i<T.length;i++)if(T[i].id==e){T[i].triggerAs(n,t,r);break}}function d(e){for(var n=0;n<T.length;n++)if(T[n].id==e)return T[n].close()}function c(e,n,t,r){for(var i=0;i<T.length;i++)if(T[i].id==e)return T[i].invokeAs(n,t,r)}function g(e,n,t){for(var r=0;r<T.length;r++)if(T[r].id==e)return T[r].invoke(n,t)}function h(){return{open:t,ready:l,close:d,trigger:u,invoke:g,triggerAs:f,invokeAs:c,deferred:function(){return b.Deferred()}}}function p(e){var n=e.indexOf("?"),t=e.indexOf("#"),r={url:e,hash:"",params:{}};if(t!=-1&&(r.hash=r.url.substring(t),r.url=r.url.substring(0,t)),n!=-1){var i=r.url.substring(n+1).split("&");r.url=r.url.substring(0,n);for(var o=0;o<i.length;o++){var s=i[o].split("=");2==s.length?r.params[s[0]]=s[1]:r.params[s[0]]=""}}return r}function v(e){return Array.prototype.slice.call(arguments,1).forEach(function(n){if(n)for(var t in n)null===n[t]||r(n[t])?delete e[t]:n[t].constructor===Object?e[t]&&e[t].constructor!==Object?e[t]=n[t]:(e[t]=e[t]||{},v(e[t],n[t])):e[t]=n[t]}),e}var m,y=0,w=!1,I=null,b=this;!function(e){function n(e){return"[object Array]"===Object.prototype.toString.call(e)}function t(e,t){if(n(e))for(var r=0;r<e.length;r++)t(e[r]);else t(e)}function r(e){var i="pending",o=[],s=[],a=[],l=null,u={done:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(n(arguments[e]))for(var t=arguments[e],r=0;r<t.length;r++)"resolved"===i&&t[r].apply(this,l),o.push(t[r]);else"resolved"===i&&arguments[e].apply(this,l),o.push(arguments[e]);return this},fail:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(n(arguments[e]))for(var t=arguments[e],r=0;r<t.length;r++)"rejected"===i&&t[r].apply(this,l),s.push(t[r]);else"rejected"===i&&arguments[e].apply(this,l),s.push(arguments[e]);return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(n(arguments[e]))for(var t=arguments[e],r=0;r<t.length;r++)"pending"===i&&a.push(t[r]);else"pending"===i&&a.push(arguments[e]);return this},then:function(){arguments.length>1&&arguments[1]&&this.fail(arguments[1]),arguments.length>0&&arguments[0]&&this.done(arguments[0]),arguments.length>2&&arguments[2]&&this.progress(arguments[2])},promise:function(e){if(null==e)return u;for(var n in u)e[n]=u[n];return e},state:function(){return i},debug:function(){console.log("[debug]",o,s,i)},isRejected:function(){return"rejected"===i},isResolved:function(){return"resolved"===i},pipe:function(e,n,i){return r(function(r){t(e,function(e){"function"==typeof e?f.done(function(){var n=e.apply(this,arguments);n&&"function"==typeof n?n.promise().then(r.resolve,r.reject,r.notify):r.resolve(n)}):f.done(r.resolve)}),t(n,function(e){"function"==typeof e?f.fail(function(){var n=e.apply(this,arguments);n&&"function"==typeof n?n.promise().then(r.resolve,r.reject,r.notify):r.reject(n)}):f.fail(r.reject)})}).promise()}},f={resolveWith:function(e){if("pending"===i){i="resolved";for(var n=l=arguments.length>1?arguments[1]:[],t=0;t<o.length;t++)o[t].apply(e,n)}return this},rejectWith:function(e){if("pending"===i){i="rejected";for(var n=l=arguments.length>1?arguments[1]:[],t=0;t<s.length;t++)s[t].apply(e,n)}return this},notifyWith:function(e){if("pending"===i)for(var n=l=arguments.length>1?arguments[1]:[],t=0;t<a.length;t++)a[t].apply(e,n);return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}},d=u.promise(f);return e&&e.apply(d,[d]),d}r.when=function(){if(arguments.length<2){var e=arguments.length?arguments[0]:void 0;return e&&"function"==typeof e.isResolved&&"function"==typeof e.isRejected?e.promise():r().resolve(e).promise()}return function(e){for(var n=r(),t=e.length,i=0,o=new Array(t),s=0;s<e.length;s++)!function(r){var s=null;e[r].done?e[r].done(function(){o[r]=arguments.length<2?arguments[0]:arguments,++i==t&&n.resolve.apply(n,o)}).fail(function(){n.reject(arguments)}):(s=e[r],e[r]=new Deferred,e[r].done(function(){o[r]=arguments.length<2?arguments[0]:arguments,++i==t&&n.resolve.apply(n,o)}).fail(function(){n.reject(arguments)}).resolve(s))}(s);return n.promise()}(arguments)},e.Deferred=r}(this);var j=function(t,o,s,a){function l(e,n){return r(k[e])&&(k[e]=[]),k[e].push(n),this}function u(e,n){return this}function f(n,t,r,i,o){var s="undefined"!=typeof i&&null!==i;r=v({await:null,messageId:null},r||{}),r.messageId||(I++,r.messageId=j+"_"+I);var a="mother",l=["dialogr.close","dialogr.block","dialogr.unblock","dialogr.open"];s?a="custom target window":null!==$&&($.child?l.indexOf(n)===-1&&(a="father"):!$.mother&&$.father&&l.indexOf(n)!==-1?a="mother":($.mother||$.father)&&(a="dialog"));var u={direction:T,source:"dialogr",messageType:n,messageData:t,messageId:r.messageId,dialogrId:o?o:D,await:r.await,fromLocation:e.location.href},f=s?i:x[a];return"undefined"==typeof f||null===f?void console.error("Target window was null or undefined",a):void f.postMessage(JSON.stringify(u),"*")}function d(e){function n(n){d++,"fail"===n.type&&(h=!1),c.push(n),d===u.length&&(clearTimeout(g),f(s.messageId+"_response",{type:h?"success":"fail",response:c},null,e.source))}function i(e){g&&n({index:a,type:"success",data:e})}function o(e){g&&n({index:a,type:"fail",data:e})}if(e.source!=window){var s,a,l;try{s=JSON.parse(e.data)}catch(e){}if(s&&!r(s.source)&&"dialogr"===s.source){if(D){if(D!==s.dialogrId)return}else if(s.messageType.indexOf("dialogr.find-opener")===-1)return;if(r(k[s.messageType]))s.await&&(console.warn("no handlers in",t,k,window.location),f(s.messageId+"_response",{type:"fail",response:["Nothing listening for '"+s.messageType+"'"]},null,e.source));else if(s.await){var u=k[s.messageType].slice(0),d=0,c=[],g=null,h=!0;for(g=setTimeout(function(){f(s.messageId+"_response",{type:"fail",response:["Operation took too long > "+s.await+"ms"]},null,e.source)},s.await),a=0;a<u.length;a++)if(l=u[a](s.messageData,s,e),s.await)if(l&&l.done&&l.fail&&l.promise)l.then(i,o);else{if(!g)return;n({apa:3,index:a,type:"success",data:l})}}else for(a=0;a<k[s.messageType].length;a++)l=k[s.messageType][a](s.messageData,s,e)}}}function c(e,n,t,r,i){var o=b.Deferred();t=v({await:5e3},t||{}),I++,t.messageId=e+"://await"+j+I,l(t.messageId+"_response",function(e,n,t){for(var r=[],i=0;i<e.response.length;i++)"string"==typeof e.response[i]?r.push(e.response[i]):e.response[i].data&&r.push(e.response[i].data);var s={messageEvent:t,message:n};"fail"===e.type?o.rejectWith(s,[1==r.length?r[0]:r]):o.resolveWith(s,[1==r.length?r[0]:r])});f(e,n,t,r,i);return o.promise()}function g(e){D=e}function h(e){y=e}function p(e){w=e}function m(e,n){"father"==e&&($.fatherIdentified=!0),x[e]=n}var y=o||null,w=null,I=0,j=n("m"),k={},D=null,T="",$=null,x={mother:o||null,father:o||null,child:null};return i(window,"message",d),T=null===o?"opener=>dialog":"dialog=>opener",{send:f,await:c,setDialogrId:g,setTargetWindow:h,setEventingTargetWindow:p,setNamedTarget:m,on:l,off:u,handleMessage:d,$$eventHandlers:k,setIdentity:function(e){$=e}}};i(e,"keydown",function(e){27===e.keyCode&&null!==I&&d()});var k=null,D=null,T=[];m=this.Deferred(),"complete"===document.readyState?m.resolve():i(window,"load",function(){m.resolve()}),e.dialogr=h()}(window);win.dialogr = Dialogr(); }(window));